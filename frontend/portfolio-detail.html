<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Portfolio Detail View</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container my-5">

        <!-- Portfolio Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 id="portfolioName">Portfolio: Retirement Fund</h2>
            </div>
            <div>
                <h5 id="targetGoal">Target: ₹75L by 2050</h5>
            </div>
        </div>

        <!-- Holdings Table -->
        <div class="table-responsive">
            <table class="table table-bordered table-hover bg-white">
                <thead class="table-dark">
                    <tr>
                        <th>Asset</th>
                        <th>Qty</th>
                        <th>Avg Price</th>
                        <th>Curr Price</th>
                        <th>P/L</th>
                    </tr>
                </thead>
                <tbody id="assetTableBody">
                    <!-- JS will populate this -->
                </tbody>
            </table>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex justify-content-start gap-3 my-3">
            <button class="btn btn-outline-primary" onclick="addTransaction()">Add Transaction</button>
            <button class="btn btn-outline-success" onclick="addAsset()">Add Asset</button>
            <button class="btn btn-outline-secondary" onclick="exportCSV()">Export CSV</button>
        </div>

        <!-- Pie Chart Placeholder (Optional Future Enhancement) -->
        <div id="chartContainer" class="mt-5">
            <!-- You can integrate a pie chart with Chart.js later -->
        </div>

    </div>

    <script>
        // Example mock fetch call for portfolio ID
        const portfolioId = "12345"; // Replace with dynamic ID in real app

        async function loadPortfolioData() {
            const res = await fetch(`/api/portfolio/${portfolioId}`);
            const data = await res.json();

            document.getElementById('portfolioName').textContent = `Portfolio: ${data.name}`;
            document.getElementById('targetGoal').textContent = `Target: ₹${data.targetAmount} by ${data.targetYear}`;

            // Populate assets table
            const tbody = document.getElementById('assetTableBody');
            tbody.innerHTML = ''; // Clear table

            data.assets.forEach(asset => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${asset.name}</td>
                    <td>${asset.quantity}</td>
                    <td>₹${asset.averagePrice.toFixed(2)}</td>
                    <td>₹${asset.currentPrice.toFixed(2)}</td>
                    <td class="${asset.profitLoss >= 0 ? 'text-success' : 'text-danger'}">
                        ₹${asset.profitLoss.toFixed(2)}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function addTransaction() {
            alert('Open transaction modal');
        }

        function addAsset() {
            alert('Open add asset form');
        }

        function exportCSV() {
            window.open(`/api/export/${portfolioId}/csv`, '_blank');
        }

        loadPortfolioData();
    </script>
</body>
</html>